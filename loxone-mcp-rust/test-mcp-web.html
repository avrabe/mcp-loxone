<!DOCTYPE html>
<html>
<head>
    <title>MCP Server Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        button { margin: 10px; padding: 5px 10px; }
        pre { background: #f0f0f0; padding: 10px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>MCP Server Test</h1>
    
    <div>
        <button onclick="testHTTP()">Test HTTP Server</button>
        <button onclick="testSSE()">Test SSE Connection</button>
    </div>
    
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message, type = '') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${new Date().toISOString()}] ${message}`;
            output.appendChild(div);
        }
        
        async function testHTTP() {
            log('Testing HTTP server...');
            
            try {
                // Test health endpoint
                const healthResponse = await fetch('http://localhost:3001/health');
                const health = await healthResponse.json();
                log(`Health check: ${JSON.stringify(health)}`, 'success');
                
                // Test initialize
                const initResponse = await fetch('http://localhost:3001/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ai-agent-default-token'
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'initialize',
                        params: {
                            protocolVersion: '2024-11-05',
                            capabilities: { tools: {} },
                            clientInfo: { name: 'web-test', version: '1.0.0' }
                        }
                    })
                });
                
                const init = await initResponse.json();
                log(`Initialize: ${JSON.stringify(init, null, 2)}`, 'success');
                
                // Test tools list
                const toolsResponse = await fetch('http://localhost:3001/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ai-agent-default-token'
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 2,
                        method: 'tools/list',
                        params: {}
                    })
                });
                
                const tools = await toolsResponse.json();
                log(`Tools: ${JSON.stringify(tools.result.tools.map(t => t.name))}`, 'success');
                
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
            }
        }
        
        async function testSSE() {
            log('Testing SSE connection...');
            
            try {
                const eventSource = new EventSource('http://localhost:3001/sse', {
                    headers: {
                        'Authorization': 'Bearer ai-agent-default-token'
                    }
                });
                
                eventSource.onopen = () => {
                    log('SSE connection opened', 'success');
                };
                
                eventSource.onmessage = (event) => {
                    log(`SSE message: ${event.data}`);
                };
                
                eventSource.onerror = (error) => {
                    log(`SSE error: ${error}`, 'error');
                    eventSource.close();
                };
                
                // Close after 10 seconds
                setTimeout(() => {
                    eventSource.close();
                    log('SSE connection closed');
                }, 10000);
                
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>